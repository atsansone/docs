--- 
buildvariants: 
  - 
    display_name: "Ubuntu 16.04"
    expansions: 
      venv: ~/venv/bin
    name: ubuntu1604
    run_on: 
      - ubuntu1604-test
    tasks: 
      - 
        name: build-docs
tasks: 
  - 
    commands: 
      - 
        command: git.get_project
        params: 
          directory: docs-mongodb
        type: setup
      - 
        command: shell.exec
        params: 
          script: |
              rm -rf ~/venv
              
              virtualenv ~/venv
              ${venv}/pip install -r requirements.txt
          working_dir: docs-mongodb
      - 
        command: shell.exec
        params: 
          script: |
              # remember that this script should be silent if it 
              # manipulates keys
              mkdir ~/.config
              touch ~/.config/giza-aws-authentication.conf
              echo "${aws_key}" > ~/.config/giza-aws-authentication.conf
              echo "${aws_secret}" >> ~/.config/giza-aws-authentication.conf
              chmod 600 ~/.config/giza-aws-authentication.conf
              
              # as an alternative, you could pass the aws keys to the
              # makefile directly if it supports that
          shell: bash
          silent: true
      - 
        command: shell.exec
        params: 
          script: |
              export USER=${github_author}
                . ${venv}/activate
              
              if [ "${is_patch}" != "true" ]; then
                make publish
                make deploy
              else
                make html
                make stage
              fi
          shell: bash
          working_dir: docs-mongodb
    name: build-docs
